{"version":3,"file":"index.js","sourceRoot":"/","sources":["game/player/events/index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as SocketIO from 'socket.io';\nimport { serverEvent } from '@events';\nimport { Player } from \"@game/player\";\nimport { characterList } from \"@game/state\";\nimport { serverSocket } from '@socket/socket';\nimport { MoveData } from \"@utils/interface\";\nimport * as ItemTemplate from '@game/item_template';\nimport * as Item from '@game/item/find';\n\nexport function OnConnection(plr: Player, socket: SocketIO.Socket) {\n  socket.on(\"PlayerMove\", function (data: MoveData) {\n    plr.Move(data);\n  });\n\n  socket.on(\"PlayerHeal\", function (data: { Points: number; }) {\n    plr.Heal(data.Points);\n  });\n\n  socket.on(\"UseItem\", async function (data: { item_uuid: string; backpack_uuid: string; }) {\n    const item = await Item.GetItemByUUID(data.item_uuid);\n    const itemTemplate = ItemTemplate.GetByID(item.item_template_id);\n\n    if (itemTemplate.type == 4)\n      plr.Equip('leftHand', item, itemTemplate, data.backpack_uuid);\n  });\n\n  socket.on(\"EquipItem\", async function (data: { slot: string;  item_uuid: string; }) {\n    const item = await Item.GetItemByUUID(data.item_uuid);\n    const itemTemplate = ItemTemplate.GetByID(item.item_template_id);\n\n    if (itemTemplate.type == 4 && data.slot == 'leftHand')\n      plr.Equip('leftHand', item, itemTemplate);\n  });\n\n  socket.on(\"UnequipItem\", async function (data: { slot: string;  item_uuid: string; backpack_uuid: string; }) {\n    plr.Unequip(data.slot, data.item_uuid, data.backpack_uuid);\n  });\n\n  socket.on(\"PlayerMessage\", function (data: { Msg: string }) {\n    serverSocket.sockets.emit(\"CharacterMessage\", { Msg: data.Msg, ID: socket.id });\n  });\n\n  socket.on(\"PlayerTarget\", function (data: { ID: string; IsTargeting: boolean }) {\n    var plr = characterList.GetByID(socket.id);\n  \n    if (plr) {\n      if (data.IsTargeting) {\n        var targetChar = characterList.GetByID(data.ID);\n        if (!targetChar) return;\n        plr.Target(targetChar);\n      } else {\n        plr.Untarget();\n      }\n    }\n  });\n\n  socket.on(\"Character:OpenEquippedBag\", function () {\n    var plr = characterList.GetByID(socket.id);\n    if (!plr) return;\n\n    // @ts-ignore - Ignore the following TypeScript error\n    serverEvent.emit(\"Backpack:Open\", {\n      socket: socket,\n      BackpackUUID: (plr as Player).syncData.equipments.bag\n    });\n  });\n}\n\n\n"]}