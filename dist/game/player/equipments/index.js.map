{"version":3,"file":"index.js","sourceRoot":"/","sources":["game/player/equipments/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Player } from '@game/player';\nimport * as ItemFind from '@game/item/find';\nimport * as ItemTemplate from '@game/item_template';\nimport * as Backpack from '@game/item/backpack/removeItem';\nimport * as BackpackInteract from '@game/item/backpack';\nimport * as BackpackAdd from '@game/item/backpack/addItem';\n\nPlayer.prototype.UpdateEquipments = async function (): Promise<void> {\n  let data = this.syncData.equipments;\n  let items = {\n    helmet: { uuid: null, image: null },\n    amulet: { uuid: null, image: null },\n    bag: { uuid: null, image: null },\n    leftHand: { uuid: null, image: null },\n    rightHand: { uuid: null, image: null },\n    armor: { uuid: null, image: null },\n    legs: { uuid: null, image: null },\n    boot: { uuid: null, image: null },\n    ring: { uuid: null, image: null },\n    ammo: { uuid: null, image: null }\n  };\n\n  for (const slot in data) {\n    // @ts-ignore - Ignore the following TypeScript error\n    if (data[slot]) {\n      // @ts-ignore - Ignore the following TypeScript error\n      const itemImage = await ItemFind.GetItemImageByItemUUID(data[slot]);\n\n      // @ts-ignore - Ignore the following TypeScript error\n      items[slot].uuid = data[slot]\n\n      // @ts-ignore - Ignore the following TypeScript error\n      items[slot].image = itemImage;\n    }\n  }\n\n  this.socket.emit(\"Character:UpdateEquipments\", { ID: this.syncData.ID, Data: items });\n  this.RecalculeAttackPower();\n}\n\nPlayer.prototype.RecalculeAttackPower = async function (): Promise<void> {\n  let recalculatedAttack = 0;\n  let data = this.syncData.equipments;\n\n  for (const slot in data) {\n    if (data[slot]) {\n      const item = await ItemFind.GetItemByUUID(data[slot]);\n      if (!item) {\n        data[slot] = null;\n        continue;\n      }\n\n      const itemTemplate = ItemTemplate.GetByID(item.item_template_id);\n\n      if (itemTemplate.attack > 0)\n        recalculatedAttack += itemTemplate.attack;\n    }\n  }\n\n  this.syncData.Attack = recalculatedAttack;\n}\n\nPlayer.prototype.Equip = async function (slot, item, itemTemplate, backpackUuid?): Promise<void> {\n  const backpackUUID = item.inside_item;\n\n  try {\n    if (this.syncData.equipments[slot] != null && backpackUuid) {\n      await BackpackAdd.AddItem(this.syncData.equipments[slot], backpackUuid);\n    }\n    else if (this.syncData.equipments[slot] != null && !backpackUuid) {\n      await BackpackAdd.AddItem(this.syncData.equipments[slot], this.syncData.equipments['bag']);\n    }\n\n    await Backpack.RemoveFromBag(item.uuid, 1);\n    await BackpackInteract.Update(this, backpackUUID);\n\n    this.syncData.equipments[slot] = item.uuid;\n\n    this.textNotification(`Você equipou um(a) ${itemTemplate.name}.`);\n    this.UpdateEquipments();\n    this.Save();\n  }\n  catch(error) {\n    console.error(\"Error on Equip: \", error);\n  }\n}\n\nPlayer.prototype.Unequip = async function (slot, itemUuid, backpackUuid): Promise<void> {\n  const haveSlots = BackpackAdd.BackpackHaveFreeSlot(backpackUuid);\n\n  if (!haveSlots) {\n    this.textNotification(`Não há espaço o suficiente na mochila.`);\n    return;\n  }\n\n  try {\n    const item = await ItemFind.GetItemByUUID(itemUuid);\n    const itemTemplate = ItemTemplate.GetByID(item.item_template_id);\n\n    await BackpackAdd.AddItem(itemUuid, backpackUuid);\n    await BackpackInteract.Update(this, backpackUuid);\n\n    this.syncData.equipments[slot] = null;\n\n    this.textNotification(`Você desequipou um(a) ${itemTemplate.name}.`);\n    this.UpdateEquipments();\n  this.Save();\n  }\n  catch(error) {\n    console.error(\"Error on Equip: \", error);\n  }\n};\n\n\n"]}