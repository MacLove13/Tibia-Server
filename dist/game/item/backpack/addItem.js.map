{"version":3,"file":"addItem.js","sourceRoot":"/","sources":["game/item/backpack/addItem.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Model from '@models/item';\nimport * as ModelIT from '@models/item_template';\nimport * as ItemFind from '@game/item/find';\nimport * as ItemTemplate from '@game/item_template';\n\nexport const AddItem = async (itemUuid: string, backpackUuid: number, item_template_id: any = null, quantity: number = 0) => {\n  if (itemUuid == null) {\n    AddOrSumNewItem(itemUuid, backpackUuid, item_template_id, quantity);\n    return;\n  }\n\n  try {\n    const item: any = await Model.Item.findOne({ where: { uuid: itemUuid } });\n    const itemTemplate: any = await ModelIT.ItemTemplate.findOne({ where:\n      {\n        id: item.item_template_id\n      }\n    });\n\n    if (item && itemTemplate) {\n      if (itemTemplate.mergeable) {\n        if (item.quantity + 1 <= 100) {\n          await item.update({\n            inside_item: backpackUuid,\n            quantity: item.quantity + quantity\n          });\n\n          return true;\n        }\n      }\n      else {\n        await item.update({\n          inside_item: backpackUuid,\n          quantity: item.quantity\n        });\n      }\n\n      \n      console.log(`Item UUID ${itemUuid}: added to bag ${backpackUuid}.`);\n      return true;\n    } else {\n      console.log(`Item with UUID ${itemUuid} not found.`);\n    }\n  } catch (error) {\n    console.error('Error in removeItemQuantity function:', error);\n  }\n\n  return false;\n};\n\nconst AddOrSumNewItem = async (itemUuid: string, backpackUuid: number, item_template_id: any = null, quantity: number = 0) => {\n  try {\n      const item: any = await Model.Item.findOne({ where:\n        {\n          item_template_id: item_template_id,\n          inside_item: backpackUuid\n        }\n      });\n\n      if (!item) {\n        await CreateItem(item_template_id, quantity, backpackUuid);\n        return true;\n      }\n\n      const itemTemplate: any = await ModelIT.ItemTemplate.findOne({ where:\n        {\n          id: item.item_template_id\n        }\n      });\n\n      if (item && itemTemplate) {\n        if (item.quantity + 1 <= 100 &&  itemTemplate.mergeable) {\n          await item.update({\n            quantity: item.quantity + quantity\n          });\n\n          return true;\n        }\n      }\n\n      await CreateItem(item_template_id, quantity, backpackUuid);\n      return true;\n    }\n    catch (error) {\n      console.log(error)\n      return false\n    }\n\n    return false;\n}\n\nconst CreateItem = async (item_template_id: any, quantity: any, inside_item: any) => {\n  await Model.Item.create({\n    item_template_id: item_template_id,\n    quantity: quantity,\n    inside_item: inside_item\n  }).then((item: any) => {\n    return true;\n  }).catch(error => {\n    console.log(error)\n    return false;\n  });\n}\n\nexport const BackpackHaveFreeSlot = async (backpackUuid) => {\n  const item = await ItemFind.GetItemByUUID(backpackUuid);\n  const itemTemplate: any = ItemTemplate.GetByID(item.item_template_id);\n\n  const itemsInBackpack = await Model.Item.findAll({\n    where: { inside_item: backpackUuid }\n  });\n\n  if ((itemsInBackpack.length + 1) <= itemTemplate.slots + 1) return true;\n  return false;\n};\n"]}